<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Centos Docker Guide - </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="../../">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">

        <!-- MathJax -->
        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li class="affix"><a href="Home.html">Introduction</a></li><li><a href="1-Sensys/1.1-Overview.html"><strong>1.</strong> Sensys</a></li><li><ul class="section"><li><a href="1-Sensys/1.2-Core-Features.html"><strong>1.1.</strong> Core features</a></li></ul></li><li><strong>2.</strong> Sensys Build and Installation</li><li><ul class="section"><li><a href="2-Build-and-Installation-Guide/2.1-Sensys-Build-and-Installation/2.1.01-Build-Dependencies.html"><strong>2.1.</strong> Build Dependencies</a></li><li><a href="2-Build-and-Installation-Guide/2.1-Sensys-Build-and-Installation/2.1.02-Pre-build-Configuration.html"><strong>2.2.</strong> Pre build Configuration</a></li><li><a href="2-Build-and-Installation-Guide/2.1-Sensys-Build-and-Installation/2.1.03-Build-From-SRPMS.html"><strong>2.3.</strong> Build From SRPMS</a></li><li><a href="2-Build-and-Installation-Guide/2.1-Sensys-Build-and-Installation/2.1.04-Relocate-RPM-Install-Path.html"><strong>2.4.</strong> Relocate RPM Install Path</a></li><li><a href="2-Build-and-Installation-Guide/2.1-Sensys-Build-and-Installation/2.1.05-Build-From-Source-Tar-Files.html"><strong>2.5.</strong> Build From Source Tar Files</a></li><li><a href="2-Build-and-Installation-Guide/2.1-Sensys-Build-and-Installation/2.1.06-Build-From-GitHub-Repo.html"><strong>2.6.</strong> Build From GitHub Repo</a></li><li><a href="2-Build-and-Installation-Guide/2.1-Sensys-Build-and-Installation/2.1.07-Post-build-Configuration.html"><strong>2.7.</strong> Post build Configuration</a></li><li><a href="2-Build-and-Installation-Guide/2.1-Sensys-Build-and-Installation/2.1.08-Setting-Up-pre-requisites-for-RAS-Monitoring.html"><strong>2.8.</strong> Setting Up pre requisites for RAS Monitoring</a></li><li><a href="2-Build-and-Installation-Guide/2.1-Sensys-Build-and-Installation/2.1.09-Startup-Instructions.html"><strong>2.9.</strong> Startup Instructions</a></li><li><a href="2-Build-and-Installation-Guide/2.1-Sensys-Build-and-Installation/2.1.10-Troubleshooting.html"><strong>2.10.</strong> Troubleshooting</a></li><li><a href="2-Build-and-Installation-Guide/2.1-Sensys-Build-and-Installation/2.1.11-Setting-MCA-Parameters.html"><strong>2.11.</strong> Setting MCA Parameters</a></li><li><strong>2.12.</strong> Database Installation</li><li><ul class="section"><li><a href="2-Build-and-Installation-Guide/2.2-Database-Installation/2.2.1-Database-Server.html"><strong>2.12.1.</strong> Database Server</a></li><li><a href="2-Build-and-Installation-Guide/2.2-Database-Installation/2.2.2-Database-Connectivity.html"><strong>2.12.2.</strong> Database Connectivity</a></li><li><a href="2-Build-and-Installation-Guide/2.2-Database-Installation/2.2.3-Enabling-Data-Purge.html"><strong>2.12.3.</strong> Enabling Data Purge</a></li><li><a href="2-Build-and-Installation-Guide/2.2-Database-Installation/2.2.4-Monitoring-Database-Size.html"><strong>2.12.4.</strong> Monitoring Database Size</a></li><li><a href="2-Build-and-Installation-Guide/2.2-Database-Installation/2.2.5-Database-Distro-Specific-Examples.html"><strong>2.12.5.</strong> Database Distro Specific Examples</a></li><li><a href="2-Build-and-Installation-Guide/2.2-Database-Installation/2.2.6-Database-ZeroMQ-Publishing.html"><strong>2.12.6.</strong> Database ZeroMQ Publishing</a></li></ul></li></ul></li><li><strong>3.</strong> Sensys User Guide</li><li><ul class="section"><li><a href="3-Sensys-User-Guide/3.1-Overview.html"><strong>3.1.</strong> Overview</a></li><li><a href="3-Sensys-User-Guide/3.2-orcmd.html"><strong>3.2.</strong> orcmd</a></li><li><a href="3-Sensys-User-Guide/3.3-orcmsched.html"><strong>3.3.</strong> orcmsched</a></li><li><a href="3-Sensys-User-Guide/3.4-Sensys-CFGI-User-Guide.html"><strong>3.4.</strong> Sensys CFGI User Guide</a></li><li><a href="3-Sensys-User-Guide/3.5-Sensys-Regex.html"><strong>3.5.</strong> Sensys Regex</a></li><li><a href="3-Sensys-User-Guide/3.6-Sensys-Logical-Grouping.html"><strong>3.6.</strong> Sensys Logical Grouping</a></li><li><a href="3-Sensys-User-Guide/3.7-octl.html"><strong>3.7.</strong> octl</a></li><li><a href="3-Sensys-User-Guide/3.8-RAS-Monitoring.html"><strong>3.8.</strong> RAS Monitoring</a></li><li><a href="3-Sensys-User-Guide/3.9-Data-Smoothing-Algorithms-Analytics.html"><strong>3.9.</strong> Data Smoothing Algorithms Analytics</a></li><li><a href="3-Sensys-User-Guide/3.10-ErrorManager-Notification.html"><strong>3.10.</strong> ErrorManager Notification</a></li><li><a href="3-Sensys-User-Guide/3.11-Diagnostics.html"><strong>3.11.</strong> Diagnostics</a></li><li><a href="3-Sensys-User-Guide/3.12-Sensys-Security-Aspects.html"><strong>3.12.</strong> Sensys Security Aspects</a></li><li><a href="3-Sensys-User-Guide/3.13-Sensys-Database-Multiple-Threads.html"><strong>3.13.</strong> Sensys Database Multiple Threads</a></li><li><a href="3-Sensys-User-Guide/3.14-Sensys-Database-Multi-Select.html"><strong>3.14.</strong> Sensys Database Multi Select</a></li></ul></li><li><strong>4.</strong> Developer Guide</li><li><ul class="section"><li><a href="4-Developer-Guide/4.1-Sensys-DB-Framework-API/4.1.1-DB-Framework-API-Design.html"><strong>4.1.</strong> DB Framework API Design</a></li><li><a href="4-Developer-Guide/4.1-Sensys-DB-Framework-API/4.1.2-DB-Framework-API.html"><strong>4.2.</strong> DB Framework API</a></li><li><a href="4-Developer-Guide/4.2-Sensys-DB-API/4.2.1-DB-API.html"><strong>4.3.</strong> DB API</a></li><li><a href="4-Developer-Guide/4.3-Sensys-DB-Schema/4.3.1-DB-Schema-V2,0.html"><strong>4.4.</strong> DB Schema V2,0</a></li><li><a href="4-Developer-Guide/4.4-Sensys-Simplified-Analytics-Interface/4.4.1-Analytics-Plugin-API.html"><strong>4.5.</strong> Analytics Plugin API</a></li><li><a href="4-Developer-Guide/4.4-Sensys-Simplified-Analytics-Interface/4.4.2-Analytics-Plugin-Development.html"><strong>4.6.</strong> Analytics Plugin Development</a></li><li><a href="4-Developer-Guide/4.4-Sensys-Simplified-Analytics-Interface/4.4.3-Analytics-Plugin-Build-Install.html"><strong>4.7.</strong> Analytics Plugin Build Install</a></li><li><a href="4-Developer-Guide/4.5-Sensys-Simplified-Sensor-Interface/4.5.1-Sensor-Plugin-API.html"><strong>4.8.</strong> Sensor Plugin API</a></li><li><a href="4-Developer-Guide/4.5-Sensys-Simplified-Sensor-Interface/4.5.2-Sensor-Plugin-Development.html"><strong>4.9.</strong> Sensor Plugin Development</a></li><li><a href="4-Developer-Guide/4.5-Sensys-Simplified-Sensor-Interface/4.5.3-Sensor-Plugin-Build-Install.html"><strong>4.10.</strong> Sensor Plugin Build Install</a></li><li><a href="4-Developer-Guide/4.6-dataContainer-reference.html"><strong>4.11.</strong> <code>dataContainer</code> class reference</a></li></ul></li><li><strong>5.</strong> Testing</li><li><ul class="section"><li><a href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html" class="active"><strong>5.1.</strong> Centos Docker Guide</a></li><li><a href="5-Testing/5.1-Docker/5.1.2-Multihost-Docker.html"><strong>5.2.</strong> Multihost Docker</a></li><li><a href="5-Testing/5.1-Docker/5.1.3-Cluster-Docker.html"><strong>5.3.</strong> Cluster Docker</a></li></ul></li><li><strong>6.</strong> Appendix</li><li><ul class="section"><li><a href="Appendix/A.1-Terminology.html"><strong>6.1.</strong> Terminology</a></li><li><a href="Appendix/A.2-Sensys-Governance-Model/A.2.1-Following-the-Open-MPI-Model.html"><strong>6.2.</strong> Following the Open MPI Model</a></li><li><a href="Appendix/A.2-Sensys-Governance-Model/A.2.2-Contributing-to-the-Source-Code.html"><strong>6.3.</strong> Contributing to the Source Code</a></li><li><a href="Appendix/A.2-Sensys-Governance-Model/A.2.3-Development-Process.html"><strong>6.4.</strong> Development Process</a></li><li><a href="Appendix/A.2-Sensys-Governance-Model/A.2.4-Roles-and-Responsibilities.html"><strong>6.5.</strong> Roles and Responsibilities</a></li><li><a href="Appendix/A.2-Sensys-Governance-Model/A.2.5-Filing-Issues.html"><strong>6.6.</strong> Filing Issues</a></li><li><a href="Appendix/A.3-Maintaining-the-Wiki.html"><strong>6.7.</strong> Maintaining the Wiki</a></li></ul></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#centos-docker-guide" id="centos-docker-guide"><h1>Centos Docker Guide</h1></a>
<p>Docker can be thought of as lightweight virtualization without a hypervisor.  It is built on top of linux containers and allows applications to run in a sandboxed environment.  Each container has its own IP address which allows us to test communications functionality of a distributed system.</p>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#installation" id="installation"><h1>Installation</h1></a>
<p><a href="https://docs.docker.com/installation/centos/">Centos Docker Installation Guide</a></p>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#selinux" id="selinux"><h3>SElinux</h3></a>
<p>Either selinux should be disabled in <code>/etc/sysconfig/selinux</code> or via cmdline or add:</p>
<pre><code>other_args=&quot;--selinux-enabled=true&quot;
</code></pre>
<p>to <code>/etc/sysconfig/docker</code></p>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#centos-6" id="centos-6"><h3>Centos 6</h3></a>
<p>Add EPEL repo to yum:
<a href="https://fedoraproject.org/wiki/EPEL#How_can_I_use_these_extra_packages.3F">EPEL Installation</a></p>
<pre><code>% yum install docker-io
% service docker start
% chkconfig docker on
</code></pre>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#centos-7" id="centos-7"><h3>Centos 7</h3></a>
<pre><code>% yum install docker
</code></pre>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#proxy" id="proxy"><h3>Proxy</h3></a>
<p>If sitting behind a proxy, it may be necessary to configure docker to provide it with the proxy settings.  See this Docker article on <a href="https://docs.docker.com/articles/systemd/">Controlling and configuring Docker using Systemd</a> for details.</p>
<p>Alternatively, on older distributions that don't support Systemd, it may be necessary to start the docker daemon as follows:</p>
<pre><code>% HTTP_PROXY=&lt;proxy&gt; docker -d &amp;
</code></pre>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#building-images" id="building-images"><h1>Building Images</h1></a>
<p>Images are built from a Dockerfile.  An example Dockerfile for building orcm from git within a centos container can be found <a href="https://github.com/benmcclelland/orcm-centos/blob/master/Dockerfile">here</a>.  More example will be available in the future. To build an image:</p>
<pre><code>$ git clone https://github.com/benmcclelland/orcm-centos.git
$ cd orcm-centos
$ docker build -t orcm .
</code></pre>
<p>or pull the pre-built image, but this one isn't guaranteed to be up to date with the latest orcm repo at all times.</p>
<pre><code>$ docker pull benmcclelland/orcm-centos
</code></pre>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#running-orcm-containers" id="running-orcm-containers"><h1>Running ORCM Containers</h1></a>
<p>A convenience script is available <a href="https://github.com/benmcclelland/orcm-centos/blob/master/run-orcm.pl">here</a> for launching an orcm container cluster.  Here is the general idea:</p>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#launch-the-database-container" id="launch-the-database-container"><h3>launch the database container</h3></a>
<pre><code>% /usr/bin/docker run -d --name db -h db intel/orcm sudo -u postgres /usr/pgsql-9.3/bin/postmaster -p 5432 -D /var/lib/pgsql/9.3/data
</code></pre>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#launch-the-scheduler" id="launch-the-scheduler"><h3>launch the scheduler</h3></a>
<pre><code>% /usr/bin/docker run -d --name master -h master --link db:db intel/orcm /opt/open-rcm/bin/orcmsched
</code></pre>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#launch-an-aggregator" id="launch-an-aggregator"><h3>launch an aggregator</h3></a>
<pre><code>% /usr/bin/docker run -d --name agg01 -h agg01 --link db:db --link master:master intel/orcm /opt/open-rcm/bin/orcmd --omca db_odbc_dsn orcmdb_psql --omca db_odbc_user orcmuser:orcmpassword --omca db_odbc_table data_sample --omca sensor heartbeat,sigar
</code></pre>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#launch-the-compute-nodes" id="launch-the-compute-nodes"><h3>launch the compute nodes</h3></a>
<pre><code> % /usr/bin/docker run -d --name node001 -h node001 --link agg01:agg01 intel/orcm /opt/open-rcm/bin/orcmd --omca sensor heartbeat,sigar 
 % /usr/bin/docker run -d --name node002 -h node002 --link agg01:agg01 --link node001:node001 intel/orcm /opt/open-rcm/bin/orcmd --omca sensor heartbeat,sigar 
...
</code></pre>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#launch-interactive-shell-simulating-login-node" id="launch-interactive-shell-simulating-login-node"><h3>launch interactive shell (simulating login node)</h3></a>
<pre><code> % /usr/bin/docker run -it --rm --link master:master --link db:db intel/orcm /bin/bash 
</code></pre>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#options" id="options"><h3>options</h3></a>
<p>The <code>-v</code> options allows us to bind mount a directory or file into the container from the host.  So if you would like to test a new orcm configuration file, you can add the option:</p>
<pre><code>% -v /path/to/orcm-site.xml:/opt/open-rcm/etc/orcm-site.xml
</code></pre>
<p>to the above docker commands.  If you want a shared home directory across the virtual cluster, you could add:</p>
<pre><code>% -v /home:/home
</code></pre>
<p>to the shell and compute nodes and they would all share the common home directory.</p>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#cleaning-up" id="cleaning-up"><h1>Cleaning up</h1></a>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#stop-all-running-containers" id="stop-all-running-containers"><h3>stop all running containers</h3></a>
<pre><code>$ docker stop $(docker ps -a -q)
</code></pre>
<a class="header" href="5-Testing/5.1-Docker/5.1.1-Centos-Docker-Guide.html#remove-containers" id="remove-containers"><h3>remove containers</h3></a>
<pre><code>$ docker rm $(docker ps -a -q)
</code></pre>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a href="4-Developer-Guide/4.6-dataContainer-reference.html" class="mobile-nav-chapters previous">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="5-Testing/5.1-Docker/5.1.2-Multihost-Docker.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="4-Developer-Guide/4.6-dataContainer-reference.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="5-Testing/5.1-Docker/5.1.2-Multihost-Docker.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        <script src="highlight.js"></script>
        <script src="book.js"></script>
    </body>
</html>
